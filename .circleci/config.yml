version: 2
jobs:
  build:
    machine: true

    #workDir: workdir

    steps:
      - checkout
      - run: |
          ls
          pwd
          cd stand
          (docker-compose up)&
          sleep 180
          (timeout 30 bash generator.sh)&
          sleep 20
          bash image.sh
          ls grafana
          ls
          docker ps
          sleep 30



      - run:
          name: install dockerize
          command: wget https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz && sudo tar -C /usr/local/bin -xzvf dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz && rm dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz
          environment:
            DOCKERIZE_VERSION: v0.3.0


      - run:
          name: creating artifacts dir
          command: mkdir /artifacts

      - store_artifacts:
          path: /artifact

